{
  "version": 3,
  "sources": ["api-definition.ts"],
  "sourcesContent": ["import * as s3 from '../../aws-s3';\nimport * as s3_assets from '../../aws-s3-assets';\n\n// keep this import separate from other imports to reduce chance for merge conflicts with v2-main\n// eslint-disable-next-line no-duplicate-imports, import/order\nimport * as cxapi from '../../cx-api';\nimport { Construct, Node } from 'constructs';\nimport { CfnRestApi } from './apigateway.generated';\nimport { IRestApi } from './restapi';\n\n                                                  \nexport abstract class ApiDefinition {\n                                                                                    \n  public static fromBucket(bucket: s3.IBucket, key: string, objectVersion?: string): S3ApiDefinition {\n    return new S3ApiDefinition(bucket, key, objectVersion);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \n  public static fromInline(definition: any): InlineApiDefinition {\n    return new InlineApiDefinition(definition);\n  }\n\n                                                                     \n  public static fromAsset(file: string, options?: s3_assets.AssetOptions): AssetApiDefinition {\n    return new AssetApiDefinition(file, options);\n  }\n\n                                                                                                                                                                                                                                                                                                       \n  public abstract bind(scope: Construct): ApiDefinitionConfig;\n\n                                                                                                                                                                                                                                                  \n  public bindAfterCreate(_scope: Construct, _restApi: IRestApi) {\n    return;\n  }\n}\n\n                                                 \nexport interface ApiDefinitionS3Location {\n                      \n  readonly bucket: string;\n                   \n  readonly key: string;\n                                                                   \n  readonly version?: string;\n}\n\n                                                         \nexport interface ApiDefinitionConfig {\n                                                                                                                                                                \n  readonly s3Location?: ApiDefinitionS3Location;\n\n                                                                                                                                       \n  readonly inlineDefinition?: any;\n}\n\n                                                    \nexport class S3ApiDefinition extends ApiDefinition {\n  private bucketName: string;\n\n  constructor(bucket: s3.IBucket, private key: string, private objectVersion?: string) {\n    super();\n\n    if (!bucket.bucketName) {\n      throw new Error('bucketName is undefined for the provided bucket');\n    }\n\n    this.bucketName = bucket.bucketName;\n  }\n\n  public bind(_scope: Construct): ApiDefinitionConfig {\n    return {\n      s3Location: {\n        bucket: this.bucketName,\n        key: this.key,\n        version: this.objectVersion,\n      },\n    };\n  }\n}\n\n                                                            \nexport class InlineApiDefinition extends ApiDefinition {\n  constructor(private definition: any) {\n    super();\n\n    if (typeof(definition) !== 'object') {\n      throw new Error('definition should be of type object');\n    }\n\n    if (Object.keys(definition).length === 0) {\n      throw new Error('JSON definition cannot be empty');\n    }\n  }\n\n  public bind(_scope: Construct): ApiDefinitionConfig {\n    return {\n      inlineDefinition: this.definition,\n    };\n  }\n}\n\n                                                   \nexport class AssetApiDefinition extends ApiDefinition {\n  private asset?: s3_assets.Asset;\n\n  constructor(private readonly path: string, private readonly options: s3_assets.AssetOptions = { }) {\n    super();\n  }\n\n  public bind(scope: Construct): ApiDefinitionConfig {\n    // If the same AssetAPIDefinition is used multiple times, retain only the first instantiation.\n    if (this.asset === undefined) {\n      this.asset = new s3_assets.Asset(scope, 'APIDefinition', {\n        path: this.path,\n        ...this.options,\n      });\n    }\n\n    if (this.asset.isZipArchive) {\n      throw new Error(`Asset cannot be a .zip file or a directory (${this.path})`);\n    }\n\n    return {\n      s3Location: {\n        bucket: this.asset.s3BucketName,\n        key: this.asset.s3ObjectKey,\n      },\n    };\n  }\n\n  public bindAfterCreate(scope: Construct, restApi: IRestApi) {\n    if (!scope.node.tryGetContext(cxapi.ASSET_RESOURCE_METADATA_ENABLED_CONTEXT)) {\n      return; // not enabled\n    }\n\n    if (!this.asset) {\n      throw new Error('bindToResource() must be called after bind()');\n    }\n\n    const child = Node.of(restApi).defaultChild as CfnRestApi;\n    child.addMetadata(cxapi.ASSET_RESOURCE_METADATA_PATH_KEY, this.asset.assetPath);\n    child.addMetadata(cxapi.ASSET_RESOURCE_METADATA_PROPERTY_KEY, 'BodyS3Location');\n  }\n}\n"],
  "mappings": "4SACA,UAAA,QAAA,uBAIA,MAAA,QAAA,gBACA,aAAA,QAAA,cAKA,mBAAmC,OAEnB,YAAW,OAAoB,IAAa,cAAsB,mEACvE,GAAI,iBAAgB,OAAQ,IAAK,qBAI5B,YAAW,WAAe,CACtC,MAAO,IAAI,qBAAoB,kBAInB,WAAU,KAAc,QAAgC,gFAC7D,GAAI,oBAAmB,KAAM,SAO/B,gBAAgB,OAAmB,SAAkB,wEApB9D,QAAA,cAAA,wHA6CA,6BAAqC,cAAa,CAGhD,YAAY,OAA4B,IAAqB,cAAsB,CACjF,QAEA,GAHsC,KAAA,IAAA,IAAqB,KAAA,cAAA,yEAGvD,CAAC,OAAO,WACV,KAAM,IAAI,OAAM,mDAGlB,KAAK,WAAa,OAAO,WAGpB,KAAK,OAAiB,CAC3B,MAAO,CACL,WAAY,CACV,OAAQ,KAAK,WACb,IAAK,KAAK,IACV,QAAS,KAAK,iBAlBtB,QAAA,gBAAA,8HAyBA,iCAAyC,cAAa,CACpD,YAAoB,WAAe,CACjC,QAEA,GAHkB,KAAA,WAAA,WAGd,MAAO,aAAgB,SACzB,KAAM,IAAI,OAAM,uCAGlB,GAAI,OAAO,KAAK,YAAY,SAAW,EACrC,KAAM,IAAI,OAAM,mCAIb,KAAK,OAAiB,CAC3B,MAAO,CACL,iBAAkB,KAAK,aAf7B,QAAA,oBAAA,0IAqBA,gCAAwC,cAAa,CAGnD,YAA6B,KAA+B,QAAkC,GAAG,CAC/F,QAD2B,KAAA,KAAA,KAA+B,KAAA,QAAA,gFAIrD,KAAK,MAAgB,CAS1B,GAPI,KAAK,QAAU,QACjB,MAAK,MAAQ,GAAI,WAAU,MAAM,MAAO,gBAAiB,CACvD,KAAM,KAAK,QACR,KAAK,WAIR,KAAK,MAAM,aACb,KAAM,IAAI,OAAM,+CAA+C,KAAK,SAGtE,MAAO,CACL,WAAY,CACV,OAAQ,KAAK,MAAM,aACnB,IAAK,KAAK,MAAM,cAKf,gBAAgB,MAAkB,QAAiB,CACxD,wEAAI,CAAC,MAAM,KAAK,cAAc,MAAM,yCAClC,OAGF,GAAI,CAAC,KAAK,MACR,KAAM,IAAI,OAAM,gDAGlB,KAAM,OAAQ,aAAA,KAAK,GAAG,SAAS,aAC/B,MAAM,YAAY,MAAM,iCAAkC,KAAK,MAAM,WACrE,MAAM,YAAY,MAAM,qCAAsC,mBAvClE,QAAA,mBAAA",
  "names": []
}
