{
  "version": 3,
  "sources": ["source-action.ts"],
  "sourcesContent": ["import * as codepipeline from '../../../aws-codepipeline';\nimport * as iam from '../../../aws-iam';\n\nimport { Action } from '../action';\nimport { sourceArtifactBounds } from '../common';\n\n// keep this import separate from other imports to reduce chance for merge conflicts with v2-main\n// eslint-disable-next-line no-duplicate-imports, import/order\nimport { Construct } from 'constructs';\n\n                                                                        \nexport interface CodeStarSourceVariables {\n                                                          \n  readonly fullRepositoryName: string;\n                                                   \n  readonly branchName: string;\n                                                                                                   \n  readonly authorDate: string;\n                                                                          \n  readonly commitId: string;\n                                                                        \n  readonly commitMessage: string;\n                                             \n  readonly connectionArn: string;\n}\n\n                                                                               \nexport interface CodeStarConnectionsSourceActionProps extends codepipeline.CommonAwsActionProps {\n                                                                                                                       \n  readonly output: codepipeline.Artifact;\n\n                                                                                                                                                                                                                                                                                                                                                                       \n  readonly connectionArn: string;\n\n                                                                                            \n  readonly owner: string;\n\n                                                                         \n  readonly repo: string;\n\n                                                                 \n  readonly branch?: string;\n\n  // long URL in @see\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \n  readonly codeBuildCloneOutput?: boolean;\n\n                                                                                                                                                                                                                                                                                                                                                                            \n  readonly triggerOnPush?: boolean;\n}\n\n                                                                                                                                \nexport class CodeStarConnectionsSourceAction extends Action {\n  /**\n   * The name of the property that holds the ARN of the CodeStar Connection\n   * inside of the CodePipeline Artifact's metadata.\n   *\n   * @internal\n   */\n  public static readonly _CONNECTION_ARN_PROPERTY = 'CodeStarConnectionArnProperty';\n\n  private readonly props: CodeStarConnectionsSourceActionProps;\n\n  constructor(props: CodeStarConnectionsSourceActionProps) {\n    super({\n      ...props,\n      category: codepipeline.ActionCategory.SOURCE,\n      owner: 'AWS', // because props also has a (different!) owner property!\n      provider: 'CodeStarSourceConnection',\n      artifactBounds: sourceArtifactBounds(),\n      outputs: [props.output],\n    });\n\n    this.props = props;\n  }\n\n                                              \n  public get variables(): CodeStarSourceVariables {\n    return {\n      fullRepositoryName: this.variableExpression('FullRepositoryName'),\n      branchName: this.variableExpression('BranchName'),\n      authorDate: this.variableExpression('AuthorDate'),\n      commitId: this.variableExpression('CommitId'),\n      commitMessage: this.variableExpression('CommitMessage'),\n      connectionArn: this.variableExpression('ConnectionArn'),\n    };\n  }\n\n  protected bound(_scope: Construct, _stage: codepipeline.IStage, options: codepipeline.ActionBindOptions): codepipeline.ActionConfig {\n    // https://docs.aws.amazon.com/codepipeline/latest/userguide/security-iam.html#how-to-update-role-new-services\n    options.role.addToPolicy(new iam.PolicyStatement({\n      actions: [\n        'codestar-connections:UseConnection',\n      ],\n      resources: [\n        this.props.connectionArn,\n      ],\n    }));\n\n    // the action needs to write the output to the pipeline bucket\n    options.bucket.grantReadWrite(options.role);\n    options.bucket.grantPutAcl(options.role);\n\n    // if codeBuildCloneOutput is true,\n    // save the connectionArn in the Artifact instance\n    // to be read by the CodeBuildAction later\n    if (this.props.codeBuildCloneOutput === true) {\n      this.props.output.setMetadata(CodeStarConnectionsSourceAction._CONNECTION_ARN_PROPERTY,\n        this.props.connectionArn);\n    }\n\n    return {\n      configuration: {\n        ConnectionArn: this.props.connectionArn,\n        FullRepositoryId: `${this.props.owner}/${this.props.repo}`,\n        BranchName: this.props.branch ?? 'master',\n        OutputArtifactFormat: this.props.codeBuildCloneOutput === true\n          ? 'CODEBUILD_CLONE_REF'\n          : undefined,\n        DetectChanges: this.props.triggerOnPush,\n      },\n    };\n  }\n}\n"],
  "mappings": "yOAAA,aAAA,QAAA,6BACA,IAAA,QAAA,oBAEA,SAAA,QAAA,aACA,SAAA,QAAA,aAgDA,6CAAqD,UAAA,MAAM,CAWzD,YAAY,MAA2C,CACrD,MAAM,IACD,MACH,SAAU,aAAa,eAAe,OACtC,MAAO,MACP,SAAU,2BACV,eAAgB,SAAA,uBAChB,QAAS,CAAC,MAAM,mHAGlB,KAAK,MAAQ,SAIJ,YAAS,CAClB,MAAO,CACL,mBAAoB,KAAK,mBAAmB,sBAC5C,WAAY,KAAK,mBAAmB,cACpC,WAAY,KAAK,mBAAmB,cACpC,SAAU,KAAK,mBAAmB,YAClC,cAAe,KAAK,mBAAmB,iBACvC,cAAe,KAAK,mBAAmB,kBAIjC,MAAM,OAAmB,OAA6B,QAAuC,mKAErG,QAAQ,KAAK,YAAY,GAAI,KAAI,gBAAgB,CAC/C,QAAS,CACP,sCAEF,UAAW,CACT,KAAK,MAAM,kBAKf,QAAQ,OAAO,eAAe,QAAQ,MACtC,QAAQ,OAAO,YAAY,QAAQ,MAK/B,KAAK,MAAM,uBAAyB,IACtC,KAAK,MAAM,OAAO,YAAY,gCAAgC,yBAC5D,KAAK,MAAM,eAGR,CACL,cAAe,CACb,cAAe,KAAK,MAAM,cAC1B,iBAAkB,GAAG,KAAK,MAAM,SAAS,KAAK,MAAM,OACpD,WAAU,IAAE,KAAK,MAAM,UAAM,MAAA,KAAA,OAAA,GAAI,SACjC,qBAAsB,KAAK,MAAM,uBAAyB,GACtD,sBACA,OACJ,cAAe,KAAK,MAAM,iBAnElC,QAAA,gCAAA,wLAOyB,gCAAA,yBAA2B",
  "names": []
}
