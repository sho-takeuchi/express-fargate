{
  "version": 3,
  "sources": ["invoke-action.ts"],
  "sourcesContent": ["import * as codepipeline from '../../../aws-codepipeline';\nimport * as iam from '../../../aws-iam';\nimport * as stepfunction from '../../../aws-stepfunctions';\nimport * as cdk from '../../../core';\nimport { Construct } from 'constructs';\nimport { Action } from '../action';\n\n                                                     \nexport class StateMachineInput {\n                                                                                                     \n  public static filePath(inputFile: codepipeline.ArtifactPath): StateMachineInput {\n    return new StateMachineInput(inputFile.location, inputFile.artifact, 'FilePath');\n  }\n\n                                                                                                                \n  public static literal(object: object): StateMachineInput {\n    return new StateMachineInput(JSON.stringify(object), undefined, 'Literal');\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                         \n  public readonly inputArtifact?: codepipeline.Artifact;\n\n                                                                                                                       \n  public readonly inputType?: string;\n\n                                                                                                                                                                                                                                                                                                                                                                                                     \n  public readonly input: any;\n\n  private constructor(input: any, inputArtifact: codepipeline.Artifact | undefined, inputType: string) {\n    this.input = input;\n    this.inputArtifact = inputArtifact;\n    this.inputType = inputType;\n  }\n}\n\n                                                                                                       \nexport interface StepFunctionsInvokeActionProps extends codepipeline.CommonAwsActionProps {\n                                                                                                                    \n  readonly output?: codepipeline.Artifact;\n\n                                             \n  readonly stateMachine: stepfunction.IStateMachine;\n\n                                                                                                                                                              \n  readonly stateMachineInput?: StateMachineInput;\n\n                                                                                                                                                                                                                                                                                                                         \n  readonly executionNamePrefix?: string;\n}\n\n                                                                            \nexport class StepFunctionInvokeAction extends Action {\n  private readonly props: StepFunctionsInvokeActionProps;\n\n  constructor(props: StepFunctionsInvokeActionProps) {\n    super({\n      ...props,\n      resource: props.stateMachine,\n      category: codepipeline.ActionCategory.INVOKE,\n      provider: 'StepFunctions',\n      artifactBounds: {\n        minInputs: 0,\n        maxInputs: 1,\n        minOutputs: 0,\n        maxOutputs: 1,\n      },\n      inputs: (props.stateMachineInput && props.stateMachineInput.inputArtifact) ? [props.stateMachineInput.inputArtifact] : [],\n      outputs: (props.output) ? [props.output] : [],\n    });\n    this.props = props;\n  }\n\n  protected bound(_scope: Construct, _stage: codepipeline.IStage, options: codepipeline.ActionBindOptions):\n  codepipeline.ActionConfig {\n    // allow pipeline to invoke this step function\n    options.role.addToPrincipalPolicy(new iam.PolicyStatement({\n      actions: ['states:StartExecution', 'states:DescribeStateMachine'],\n      resources: [this.props.stateMachine.stateMachineArn],\n    }));\n\n    // allow state machine executions to be inspected\n    options.role.addToPrincipalPolicy(new iam.PolicyStatement({\n      actions: ['states:DescribeExecution'],\n      resources: [cdk.Stack.of(this.props.stateMachine).formatArn({\n        service: 'states',\n        resource: 'execution',\n        resourceName: `${cdk.Stack.of(this.props.stateMachine).splitArn(this.props.stateMachine.stateMachineArn, cdk.ArnFormat.COLON_RESOURCE_NAME).resourceName}:${this.props.executionNamePrefix ?? ''}*`,\n        arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,\n      })],\n    }));\n\n    // allow the Role access to the Bucket, if there are any inputs/outputs\n    if ((this.actionProperties.inputs ?? []).length > 0) {\n      options.bucket.grantRead(options.role);\n    }\n    if ((this.actionProperties.outputs ?? []).length > 0) {\n      options.bucket.grantWrite(options.role);\n    }\n\n    return {\n      configuration: {\n        StateMachineArn: this.props.stateMachine.stateMachineArn,\n        Input: this.props.stateMachineInput?.input,\n        InputType: this.props.stateMachineInput?.inputType,\n        ExecutionNamePrefix: this.props.executionNamePrefix,\n      },\n    };\n  }\n}"],
  "mappings": "+PAAA,aAAA,QAAA,6BACA,IAAA,QAAA,oBAEA,IAAA,QAAA,iBAEA,SAAA,QAAA,aAGA,uBAA8B,CAoB5B,YAAoB,MAAY,cAAkD,UAAiB,CACjG,KAAK,MAAQ,MACb,KAAK,cAAgB,cACrB,KAAK,UAAY,gBArBL,UAAS,UAAoC,qFAClD,GAAI,mBAAkB,UAAU,SAAU,UAAU,SAAU,kBAIzD,SAAQ,OAAc,CAClC,MAAO,IAAI,mBAAkB,KAAK,UAAU,QAAS,OAAW,YARpE,QAAA,kBAAA,8IA2CA,sCAA8C,UAAA,MAAM,CAGlD,YAAY,MAAqC,CAC/C,MAAM,IACD,MACH,SAAU,MAAM,aAChB,SAAU,aAAa,eAAe,OACtC,SAAU,gBACV,eAAgB,CACd,UAAW,EACX,UAAW,EACX,WAAY,EACZ,WAAY,GAEd,OAAS,MAAM,mBAAqB,MAAM,kBAAkB,cAAiB,CAAC,MAAM,kBAAkB,eAAiB,GACvH,QAAU,MAAM,OAAU,CAAC,MAAM,QAAU,wGAE7C,KAAK,MAAQ,MAGL,MAAM,OAAmB,OAA6B,QAAuC,+KAGrG,QAAQ,KAAK,qBAAqB,GAAI,KAAI,gBAAgB,CACxD,QAAS,CAAC,wBAAyB,+BACnC,UAAW,CAAC,KAAK,MAAM,aAAa,oBAItC,QAAQ,KAAK,qBAAqB,GAAI,KAAI,gBAAgB,CACxD,QAAS,CAAC,4BACV,UAAW,CAAC,IAAI,MAAM,GAAG,KAAK,MAAM,cAAc,UAAU,CAC1D,QAAS,SACT,SAAU,YACV,aAAc,GAAG,IAAI,MAAM,GAAG,KAAK,MAAM,cAAc,SAAS,KAAK,MAAM,aAAa,gBAAiB,IAAI,UAAU,qBAAqB,gBAAgB,IAAA,KAAK,MAAM,uBAAmB,MAAA,KAAA,OAAA,GAAI,MAC9L,UAAW,IAAI,UAAU,0BAKzB,KAAC,KAAK,iBAAiB,UAAM,MAAA,KAAA,OAAA,GAAI,IAAI,OAAS,GAChD,QAAQ,OAAO,UAAU,QAAQ,MAE/B,KAAC,KAAK,iBAAiB,WAAO,MAAA,KAAA,OAAA,GAAI,IAAI,OAAS,GACjD,QAAQ,OAAO,WAAW,QAAQ,MAG7B,CACL,cAAe,CACb,gBAAiB,KAAK,MAAM,aAAa,gBACzC,MAAK,IAAE,KAAK,MAAM,qBAAiB,MAAA,KAAA,OAAA,OAAA,GAAE,MACrC,UAAS,IAAE,KAAK,MAAM,qBAAiB,MAAA,KAAA,OAAA,OAAA,GAAE,UACzC,oBAAqB,KAAK,MAAM,uBArDxC,QAAA,yBAAA",
  "names": []
}
