{
  "version": 3,
  "sources": ["alias.ts"],
  "sourcesContent": ["import * as iam from '../../aws-iam';\nimport { RemovalPolicy, Resource, Stack, Token } from '../../core';\nimport { Construct } from 'constructs';\nimport { IKey } from './key';\nimport { CfnAlias } from './kms.generated';\n\nconst REQUIRED_ALIAS_PREFIX = 'alias/';\nconst DISALLOWED_PREFIX = REQUIRED_ALIAS_PREFIX + 'aws/';\n\n                                                                                    \nexport interface IAlias extends IKey {\n                                                            \n  readonly aliasName: string;\n\n                                                                        \n  readonly aliasTargetKey: IKey;\n}\n\n                                                              \nexport interface AliasProps {\n                                                                                                                                                                                                              \n  readonly aliasName: string;\n\n                                                                                                                                                                                               \n  readonly targetKey: IKey;\n\n                                                                                                                          \n  readonly removalPolicy?: RemovalPolicy;\n}\n\nabstract class AliasBase extends Resource implements IAlias {\n  public abstract readonly aliasName: string;\n\n  public abstract readonly aliasTargetKey: IKey;\n\n  public get keyArn(): string {\n    return Stack.of(this).formatArn({\n      service: 'kms',\n      // aliasName already contains the '/'\n      resource: this.aliasName,\n    });\n  }\n\n  public get keyId(): string {\n    return this.aliasName;\n  }\n\n  public addAlias(alias: string): Alias {\n    return this.aliasTargetKey.addAlias(alias);\n  }\n\n  public addToResourcePolicy(statement: iam.PolicyStatement, allowNoOp?: boolean): iam.AddToResourcePolicyResult {\n    return this.aliasTargetKey.addToResourcePolicy(statement, allowNoOp);\n  }\n\n  public grant(grantee: iam.IGrantable, ...actions: string[]): iam.Grant {\n    return this.aliasTargetKey.grant(grantee, ...actions);\n  }\n\n  public grantDecrypt(grantee: iam.IGrantable): iam.Grant {\n    return this.aliasTargetKey.grantDecrypt(grantee);\n  }\n\n  public grantEncrypt(grantee: iam.IGrantable): iam.Grant {\n    return this.aliasTargetKey.grantEncrypt(grantee);\n  }\n\n  public grantEncryptDecrypt(grantee: iam.IGrantable): iam.Grant {\n    return this.aliasTargetKey.grantEncryptDecrypt(grantee);\n  }\n}\n\n                                                             \nexport interface AliasAttributes {\n                                                                                                                         \n  readonly aliasName: string;\n\n                                                                         \n  readonly aliasTargetKey: IKey;\n}\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \nexport class Alias extends AliasBase {\n                                                                                                                                                                                                                                                   \n  public static fromAliasAttributes(scope: Construct, id: string, attrs: AliasAttributes): IAlias {\n    class _Alias extends AliasBase {\n      public get aliasName() { return attrs.aliasName; }\n      public get aliasTargetKey() { return attrs.aliasTargetKey; }\n    }\n    return new _Alias(scope, id);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \n  public static fromAliasName(scope: Construct, id: string, aliasName: string): IAlias {\n    class Import extends Resource implements IAlias {\n      public readonly keyArn = Stack.of(this).formatArn({ service: 'kms', resource: aliasName });\n      public readonly keyId = aliasName;\n      public readonly aliasName = aliasName;\n      public get aliasTargetKey(): IKey { throw new Error('Cannot access aliasTargetKey on an Alias imported by Alias.fromAliasName().'); }\n      public addAlias(_alias: string): Alias { throw new Error('Cannot call addAlias on an Alias imported by Alias.fromAliasName().'); }\n      public addToResourcePolicy(_statement: iam.PolicyStatement, _allowNoOp?: boolean): iam.AddToResourcePolicyResult {\n        return { statementAdded: false };\n      }\n      public grant(grantee: iam.IGrantable, ..._actions: string[]): iam.Grant { return iam.Grant.drop(grantee, ''); }\n      public grantDecrypt(grantee: iam.IGrantable): iam.Grant { return iam.Grant.drop(grantee, ''); }\n      public grantEncrypt(grantee: iam.IGrantable): iam.Grant { return iam.Grant.drop(grantee, ''); }\n      public grantEncryptDecrypt(grantee: iam.IGrantable): iam.Grant { return iam.Grant.drop(grantee, ''); }\n    }\n\n    return new Import(scope, id);\n  }\n\n  public readonly aliasName: string;\n  public readonly aliasTargetKey: IKey;\n\n  constructor(scope: Construct, id: string, props: AliasProps) {\n    let aliasName = props.aliasName;\n\n    if (!Token.isUnresolved(aliasName)) {\n      if (!aliasName.startsWith(REQUIRED_ALIAS_PREFIX)) {\n        aliasName = REQUIRED_ALIAS_PREFIX + aliasName;\n      }\n\n      if (aliasName === REQUIRED_ALIAS_PREFIX) {\n        throw new Error(`Alias must include a value after \"${REQUIRED_ALIAS_PREFIX}\": ${aliasName}`);\n      }\n\n      if (aliasName.toLocaleLowerCase().startsWith(DISALLOWED_PREFIX)) {\n        throw new Error(`Alias cannot start with ${DISALLOWED_PREFIX}: ${aliasName}`);\n      }\n\n      if (!aliasName.match(/^[a-zA-Z0-9:/_-]{1,256}$/)) {\n        throw new Error('Alias name must be between 1 and 256 characters in a-zA-Z0-9:/_-');\n      }\n    }\n\n    super(scope, id, {\n      physicalName: aliasName,\n    });\n\n    this.aliasTargetKey = props.targetKey;\n\n    const resource = new CfnAlias(this, 'Resource', {\n      aliasName: this.physicalName,\n      targetKeyId: this.aliasTargetKey.keyArn,\n    });\n\n    this.aliasName = this.getResourceNameAttribute(resource.aliasName);\n\n    if (props.removalPolicy) {\n      resource.applyRemovalPolicy(props.removalPolicy);\n    }\n  }\n\n  protected generatePhysicalName(): string {\n    return REQUIRED_ALIAS_PREFIX + super.generatePhysicalName();\n  }\n}\n"],
  "mappings": "4MAAA,IAAA,QAAA,iBACA,OAAA,QAAA,cAGA,gBAAA,QAAA,mBAEM,sBAAwB,SACxB,kBAAoB,sBAAwB,OAuBlD,uBAAiC,QAAA,QAAQ,IAK5B,SAAM,CACf,MAAO,QAAA,MAAM,GAAG,MAAM,UAAU,CAC9B,QAAS,MAET,SAAU,KAAK,eAIR,QAAK,CACd,MAAO,MAAK,UAGP,SAAS,MAAa,CAC3B,MAAO,MAAK,eAAe,SAAS,OAG/B,oBAAoB,UAAgC,UAAmB,CAC5E,MAAO,MAAK,eAAe,oBAAoB,UAAW,WAGrD,MAAM,WAA4B,QAAiB,CACxD,MAAO,MAAK,eAAe,MAAM,QAAS,GAAG,SAGxC,aAAa,QAAuB,CACzC,MAAO,MAAK,eAAe,aAAa,SAGnC,aAAa,QAAuB,CACzC,MAAO,MAAK,eAAe,aAAa,SAGnC,oBAAoB,QAAuB,CAChD,MAAO,MAAK,eAAe,oBAAoB,UAcnD,mBAA2B,UAAS,CAiClC,YAAY,MAAkB,GAAY,MAAiB,+DACzD,GAAI,WAAY,MAAM,UAEtB,GAAI,CAAC,OAAA,MAAM,aAAa,WAAY,CAKlC,GAJK,UAAU,WAAW,wBACxB,WAAY,sBAAwB,WAGlC,YAAc,sBAChB,KAAM,IAAI,OAAM,qCAAqC,2BAA2B,aAGlF,GAAI,UAAU,oBAAoB,WAAW,mBAC3C,KAAM,IAAI,OAAM,2BAA2B,sBAAsB,aAGnE,GAAI,CAAC,UAAU,MAAM,4BACnB,KAAM,IAAI,OAAM,oEAIpB,MAAM,MAAO,GAAI,CACf,aAAc,YAGhB,KAAK,eAAiB,MAAM,UAE5B,KAAM,UAAW,GAAI,iBAAA,SAAS,KAAM,WAAY,CAC9C,UAAW,KAAK,aAChB,YAAa,KAAK,eAAe,SAGnC,KAAK,UAAY,KAAK,yBAAyB,SAAS,WAEpD,MAAM,eACR,SAAS,mBAAmB,MAAM,qBAlExB,qBAAoB,MAAkB,GAAY,MAAsB,oEACpF,qBAAqB,UAAS,IACjB,YAAS,CAAK,MAAO,OAAM,aAC3B,iBAAc,CAAK,MAAO,OAAM,gBAE7C,MAAO,IAAI,SAAO,MAAO,UAIb,eAAc,MAAkB,GAAY,UAAiB,CACzE,oBAAqB,QAAA,QAAQ,CAA7B,aAAA,qBACkB,KAAA,OAAS,OAAA,MAAM,GAAG,MAAM,UAAU,CAAE,QAAS,MAAO,SAAU,YAC9D,KAAA,MAAQ,UACR,KAAA,UAAY,aACjB,iBAAc,CAAW,KAAM,IAAI,OAAM,+EAC7C,SAAS,OAAc,CAAW,KAAM,IAAI,OAAM,uEAClD,oBAAoB,WAAiC,WAAoB,CAC9E,MAAO,CAAE,eAAgB,IAEpB,MAAM,WAA4B,SAAkB,CAAe,MAAO,KAAI,MAAM,KAAK,QAAS,IAClG,aAAa,QAAuB,CAAe,MAAO,KAAI,MAAM,KAAK,QAAS,IAClF,aAAa,QAAuB,CAAe,MAAO,KAAI,MAAM,KAAK,QAAS,IAClF,oBAAoB,QAAuB,CAAe,MAAO,KAAI,MAAM,KAAK,QAAS,KAGlG,MAAO,IAAI,QAAO,MAAO,IA6CjB,sBAAoB,CAC5B,MAAO,uBAAwB,MAAM,wBAzEzC,QAAA,MAAA",
  "names": []
}
