{
  "version": 3,
  "sources": ["send-to-queue.ts"],
  "sourcesContent": ["import * as iam from '../../../aws-iam';\nimport * as sqs from '../../../aws-sqs';\nimport * as sfn from '../../../aws-stepfunctions';\nimport { Duration } from '../../../core';\nimport { getResourceArn } from '../resource-arn-suffix';\n\n                                                                                \nexport interface SendToQueueProps {\n                                                       \n  readonly messageBody: sfn.TaskInput;\n\n                                                                                                                                                                                       \n  readonly delay?: Duration;\n\n                                                                                                                      \n  readonly messageDeduplicationId?: string;\n\n                                                                                                                                                                                                                                \n  readonly messageGroupId?: string;\n\n                                                                                                                                                                                                                    \n  readonly integrationPattern?: sfn.ServiceIntegrationPattern;\n}\n\n                                                                                                                                                                                                                                                       \nexport class SendToQueue implements sfn.IStepFunctionsTask {\n\n  private readonly integrationPattern: sfn.ServiceIntegrationPattern;\n\n  constructor(private readonly queue: sqs.IQueue, private readonly props: SendToQueueProps) {\n    this.integrationPattern = props.integrationPattern || sfn.ServiceIntegrationPattern.FIRE_AND_FORGET;\n\n    const supportedPatterns = [\n      sfn.ServiceIntegrationPattern.FIRE_AND_FORGET,\n      sfn.ServiceIntegrationPattern.WAIT_FOR_TASK_TOKEN,\n    ];\n\n    if (!supportedPatterns.includes(this.integrationPattern)) {\n      throw new Error(`Invalid Service Integration Pattern: ${this.integrationPattern} is not supported to call SQS.`);\n    }\n\n    if (props.integrationPattern === sfn.ServiceIntegrationPattern.WAIT_FOR_TASK_TOKEN) {\n      if (!sfn.FieldUtils.containsTaskToken(props.messageBody)) {\n        throw new Error('Task Token is missing in messageBody (pass JsonPath.taskToken somewhere in messageBody)');\n      }\n    }\n  }\n\n  public bind(_task: sfn.Task): sfn.StepFunctionsTaskConfig {\n    return {\n      resourceArn: getResourceArn('sqs', 'sendMessage', this.integrationPattern),\n      policyStatements: [new iam.PolicyStatement({\n        actions: ['sqs:SendMessage'],\n        resources: [this.queue.queueArn],\n      })],\n      parameters: {\n        QueueUrl: this.queue.queueUrl,\n        MessageBody: this.props.messageBody.value,\n        DelaySeconds: this.props.delay && this.props.delay.toSeconds(),\n        MessageDeduplicationId: this.props.messageDeduplicationId,\n        MessageGroupId: this.props.messageGroupId,\n      },\n    };\n  }\n}\n"],
  "mappings": "uJAAA,IAAA,QAAA,oBAEA,IAAA,QAAA,8BAEA,sBAAA,QAAA,0BAqBA,iBAAwB,CAItB,YAA6B,MAAoC,MAAuB,CAQtF,GAR2B,KAAA,MAAA,MAAoC,KAAA,MAAA,MAC/D,KAAK,mBAAqB,MAAM,oBAAsB,IAAI,0BAA0B,gBAOhF,CAAC,AALqB,CACxB,IAAI,0BAA0B,gBAC9B,IAAI,0BAA0B,qBAGT,SAAS,KAAK,oBACnC,KAAM,IAAI,OAAM,wCAAwC,KAAK,oDAG/D,GAAI,MAAM,qBAAuB,IAAI,0BAA0B,qBACzD,CAAC,IAAI,WAAW,kBAAkB,MAAM,aAC1C,KAAM,IAAI,OAAM,2FAKf,KAAK,MAAe,CACzB,MAAO,CACL,YAAa,sBAAA,eAAe,MAAO,cAAe,KAAK,oBACvD,iBAAkB,CAAC,GAAI,KAAI,gBAAgB,CACzC,QAAS,CAAC,mBACV,UAAW,CAAC,KAAK,MAAM,aAEzB,WAAY,CACV,SAAU,KAAK,MAAM,SACrB,YAAa,KAAK,MAAM,YAAY,MACpC,aAAc,KAAK,MAAM,OAAS,KAAK,MAAM,MAAM,YACnD,uBAAwB,KAAK,MAAM,uBACnC,eAAgB,KAAK,MAAM,kBAnCnC,QAAA,YAAA",
  "names": []
}
