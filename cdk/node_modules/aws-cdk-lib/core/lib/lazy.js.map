{
  "version": 3,
  "sources": ["lazy.ts"],
  "sourcesContent": ["import { CDK_DEBUG, debugModeEnabled } from './debug';\nimport { IResolvable, IResolveContext } from './resolvable';\nimport { captureStackTrace } from './stack-trace';\nimport { Token } from './token';\n\n                                              \nexport interface IStringProducer {\n                                         \n  produce(context: IResolveContext): string | undefined;\n}\n\n                                                       \nexport interface IStableStringProducer {\n                                         \n  produce(): string | undefined;\n}\n\n                                            \nexport interface IListProducer {\n                                       \n  produce(context: IResolveContext): string[] | undefined;\n}\n\n                                                     \nexport interface IStableListProducer {\n                                       \n  produce(): string[] | undefined;\n}\n\n                                              \nexport interface INumberProducer {\n                                         \n  produce(context: IResolveContext): number | undefined;\n}\n\n                                                       \nexport interface IStableNumberProducer {\n                                         \n  produce(): number | undefined;\n}\n\n                                                     \nexport interface IAnyProducer {\n                                  \n  produce(context: IResolveContext): any;\n}\n\n                                                              \nexport interface IStableAnyProducer {\n                                  \n  produce(): any;\n}\n\n                                                   \nexport interface LazyStringValueOptions {\n                                                                                  \n  readonly displayHint?: string;\n}\n\n                                                 \nexport interface LazyListValueOptions {\n                                                                                  \n  readonly displayHint?: string;\n\n                                                                                                   \n  readonly omitEmpty?: boolean;\n}\n\n                                                   \nexport interface LazyAnyValueOptions {\n                                                                                  \n  readonly displayHint?: string;\n\n                                                                                                                       \n  readonly omitEmptyArray?: boolean;\n}\n\n                                                                                                                                                                    \nexport class Lazy {\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n  public static stringValue(producer: IStringProducer, options: LazyStringValueOptions = {}) {\n    return Token.asString(new LazyString(producer, false), options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n  public static string(producer: IStableStringProducer, options: LazyStringValueOptions = {}) {\n    return Token.asString(new LazyString(producer, true), options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n  public static uncachedString(producer: IStringProducer, options: LazyStringValueOptions = {}) {\n    return Token.asString(new LazyString(producer, false), options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \n  public static numberValue(producer: INumberProducer) {\n    return Token.asNumber(new LazyNumber(producer, false));\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \n  public static number(producer: IStableNumberProducer) {\n    return Token.asNumber(new LazyNumber(producer, true));\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n  public static uncachedNumber(producer: INumberProducer) {\n    return Token.asNumber(new LazyNumber(producer, false));\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \n  public static listValue(producer: IListProducer, options: LazyListValueOptions = {}) {\n    return Token.asList(new LazyList(producer, false, options), options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         \n  public static uncachedList(producer: IListProducer, options: LazyListValueOptions = {}) {\n    return Token.asList(new LazyList(producer, false, options), options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \n  public static list(producer: IStableListProducer, options: LazyListValueOptions = {}) {\n    return Token.asList(new LazyList(producer, true, options), options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                     \n  public static anyValue(producer: IAnyProducer, options: LazyAnyValueOptions = {}): IResolvable {\n    return new LazyAny(producer, false, options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                      \n  public static any(producer: IStableAnyProducer, options: LazyAnyValueOptions = {}): IResolvable {\n    return new LazyAny(producer, true, options);\n  }\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \n  public static uncachedAny(producer: IAnyProducer, options: LazyAnyValueOptions = {}): IResolvable {\n    return new LazyAny(producer, false, options);\n  }\n\n  private constructor() {\n  }\n}\n\n\ninterface ILazyProducer<A> {\n  produce(context: IResolveContext): A | undefined;\n}\n\nabstract class LazyBase<A> implements IResolvable {\n  public readonly creationStack: string[];\n  private _cached?: A;\n\n  constructor(private readonly producer: ILazyProducer<A>, private readonly cache: boolean) {\n    // Stack trace capture is conditionned to `debugModeEnabled()`, because\n    // lazies can be created in a fairly thrashy way, and the stack traces are\n    // large and slow to obtain; but are mostly useful only when debugging a\n    // resolution issue.\n    this.creationStack = debugModeEnabled()\n      ? captureStackTrace(this.constructor)\n      : [`Execute again with ${CDK_DEBUG}=true to capture stack traces`];\n  }\n\n  public resolve(context: IResolveContext) {\n    if (this.cache) {\n      return this._cached ?? (this._cached = this.producer.produce(context));\n    } else {\n      return this.producer.produce(context);\n    }\n  }\n\n  public toString() {\n    return Token.asString(this);\n  }\n\n  /**\n   * Turn this Token into JSON\n   *\n   * Called automatically when JSON.stringify() is called on a Token.\n   */\n  public toJSON(): any {\n    return '<unresolved-lazy>';\n  }\n\n}\n\nclass LazyString extends LazyBase<string> {\n}\n\nclass LazyNumber extends LazyBase<number> {\n}\n\nclass LazyList extends LazyBase<Array<string>> {\n  constructor(producer: IListProducer, cache: boolean, private readonly options: LazyListValueOptions = {}) {\n    super(producer, cache);\n  }\n\n  public resolve(context: IResolveContext) {\n    const resolved = super.resolve(context);\n    if (resolved?.length === 0 && this.options.omitEmpty) {\n      return undefined;\n    }\n    return resolved;\n  }\n}\n\nclass LazyAny extends LazyBase<any> {\n  constructor(producer: IAnyProducer, cache: boolean, private readonly options: LazyAnyValueOptions = {}) {\n    super(producer, cache);\n  }\n\n  public resolve(context: IResolveContext) {\n    const resolved = super.resolve(context);\n    if (Array.isArray(resolved) && resolved.length === 0 && this.options.omitEmptyArray) {\n      return undefined;\n    }\n    return resolved;\n  }\n}\n"],
  "mappings": "2MAAA,QAAA,QAAA,WAEA,cAAA,QAAA,iBACA,QAAA,QAAA,WA2EA,UAAiB,CA6Df,aAAA,QA3Dc,aAAY,SAA2B,QAAkC,GAAE,CACvF,MAAO,SAAA,MAAM,SAAS,GAAI,YAAW,SAAU,IAAQ,eAI3C,QAAO,SAAiC,QAAkC,GAAE,gJACjF,QAAA,MAAM,SAAS,GAAI,YAAW,SAAU,IAAO,eAI1C,gBAAe,SAA2B,QAAkC,GAAE,0IACnF,QAAA,MAAM,SAAS,GAAI,YAAW,SAAU,IAAQ,eAI3C,aAAY,SAAyB,CACjD,MAAO,SAAA,MAAM,SAAS,GAAI,YAAW,SAAU,WAInC,QAAO,SAA+B,4EAC3C,QAAA,MAAM,SAAS,GAAI,YAAW,SAAU,WAInC,gBAAe,SAAyB,sEAC7C,QAAA,MAAM,SAAS,GAAI,YAAW,SAAU,WAInC,WAAU,SAAyB,QAAgC,GAAE,CACjF,MAAO,SAAA,MAAM,OAAO,GAAI,UAAS,SAAU,GAAO,SAAU,eAIhD,cAAa,SAAyB,QAAgC,GAAE,sIAC7E,QAAA,MAAM,OAAO,GAAI,UAAS,SAAU,GAAO,SAAU,eAIhD,MAAK,SAA+B,QAAgC,GAAE,4IAC3E,QAAA,MAAM,OAAO,GAAI,UAAS,SAAU,GAAM,SAAU,eAI/C,UAAS,SAAwB,QAA+B,GAAE,CAC9E,MAAO,IAAI,SAAQ,SAAU,GAAO,eAIxB,KAAI,SAA8B,QAA+B,GAAE,0IACxE,GAAI,SAAQ,SAAU,GAAM,eAIvB,aAAY,SAAwB,QAA+B,GAAE,oIAC1E,GAAI,SAAQ,SAAU,GAAO,UA1DxC,QAAA,KAAA,8EAsEA,cAAuB,CAIrB,YAA6B,SAA6C,MAAc,CAA3D,KAAA,SAAA,SAA6C,KAAA,MAAA,MAKxE,KAAK,cAAgB,QAAA,mBACjB,cAAA,kBAAkB,KAAK,aACvB,CAAC,sBAAsB,QAAA,0CAGtB,QAAQ,QAAwB,QACrC,MAAI,MAAK,MACP,IAAO,KAAK,WAAO,MAAA,KAAA,OAAA,GAAK,KAAK,QAAU,KAAK,SAAS,QAAQ,SAEtD,KAAK,SAAS,QAAQ,SAI1B,UAAQ,CACb,MAAO,SAAA,MAAM,SAAS,MAQjB,QAAM,CACX,MAAO,qBAKX,wBAAyB,SAAgB,EAGzC,wBAAyB,SAAgB,EAGzC,sBAAuB,SAAuB,CAC5C,YAAY,SAAyB,MAAiC,QAAgC,GAAE,CACtG,MAAM,SAAU,OADoD,KAAA,QAAA,QAI/D,QAAQ,QAAwB,CACrC,KAAM,UAAW,MAAM,QAAQ,SAC/B,GAAI,aAAQ,KAAA,OAAR,SAAU,UAAW,GAAK,KAAK,QAAQ,WAG3C,MAAO,WAIX,qBAAsB,SAAa,CACjC,YAAY,SAAwB,MAAiC,QAA+B,GAAE,CACpG,MAAM,SAAU,OADmD,KAAA,QAAA,QAI9D,QAAQ,QAAwB,CACrC,KAAM,UAAW,MAAM,QAAQ,SAC/B,GAAI,QAAM,QAAQ,WAAa,SAAS,SAAW,GAAK,KAAK,QAAQ,gBAGrE,MAAO",
  "names": []
}
